<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.2">
<meta name="author" content="By">
<title>Explaining Trump and Brexit with Tidy Data Graphics</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style type="text/css">
  .main-menu ul {
  list-style-type: none; margin: 0; padding: 0; overflow: hidden; background-color: #F8F8F7; position: fixed; top: 0; width: 100%;
  }
  .main-menu li {
    float: left;
  }
  .main-menu li a {
    display: block; color: #262626; text-align: center; padding: 14px 16px; text-decoration: none;
  }
  /* Change the link color to #111 (black) on hover */
  .main-menu li a:hover {
    background-color: #E0E0DC;
  }
  h1 {
      padding-top: 50px;
  }
</style>
</head>
<body class="article">
<div id="header">
<h1>Explaining Trump and Brexit with Tidy Data Graphics</h1>
<div class="details">
<span id="author" class="author">By</span><br>
<span id="email" class="email"><a href="https://www.roger-beecham.com">Roger Beecham</a></span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="ulist main-menu">
<ul>
<li>
<p><a href="index.html">Home</a></p>
</li>
<li>
<p><a href="data-vis.html">Data Visualization</a></p>
</li>
<li>
<p><a href="r-studio.html">R and RStudio</a></p>
</li>
<li>
<p><a href="code1.html">Code #1</a></p>
</li>
<li>
<p><a href="code2.html">Code #2</a></p>
</li>
<li>
<p><a href="code3.html">Code #3</a></p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>In this session you will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>perform a linear regression analysis and use graphics to make decisions about model fit</p>
</li>
<li>
<p>generate graphical small multiples with <code>ggplot2</code></p>
</li>
<li>
<p>make use of more involved <em>dplyr</em> functions, such as <code>gather()</code>, for preparing R data frames for charting</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_investigate_candidate_explanations_behind_area_level_vote">Investigate candidate 'explanations' behind area-level vote</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_task_1_association_between_trump_and_brexit_and_levels_of_degree_education">Task 1. Association between Trump and Brexit and levels of (degree) education</h3>
<div class="paragraph">
<p>We finished the previous session by plotting maps of area-level voting behaviour and of area-level demographics. Visually scanning across the maps, you <em>might</em> have observed that area-level variation in the vote co-varies with demographic characteristics. Any systematic co-variation would be interesting given the popular discourse on the Trump and Brexit vote&#8201;&#8212;&#8201;that they&#8217;re symptomatic of people and places structurally <a href="https://www.theguardian.com/politics/2016/jun/25/left-behind-eu-referendum-vote-ukip-revolt-brexit">left behind</a> by economic change.</p>
</div>
<div class="sect3">
<h4 id="_create_a_scatterplot_of_em_degree_educated_em_on_the_outcome">Create a scatterplot of <em>degree-educated</em> on the outcome</h4>
<div class="openblock">
<div class="title">Figure 1: Scatterplots containing varying extents of correlation coefficient.</div>
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="images/correlation.png" alt="correlation"></span></p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A much-cited, but nevertheless compelling, argument for the use of visualization in data analysis&#8201;&#8212;&#8201;<a href="https://en.wikipedia.org/wiki/Anscombe%27s_quartet">Anscombe&#8217;s quartet</a>&#8201;&#8212;&#8201;make great use of the scatterplot. For a fun take on this, see this <a href="https://www.autodeskresearch.com/publications/samestats">CHI paper</a>. You can reproduce plots of your own in R using the <a href="https://github.com/stephlocke/datasauRus">datasauRus</a> package.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The association between demographics and the voter outcome variables can be analysed more directly through correlation analysis.  You will have learnt that the <em>correlation coefficient (r.)</em> summarises the strength of linear association between two variables. It is a quantity that ranges from perfect negative correlation (-1) to perfect positive correlation (+1) and can be considered a measure of <em>effect size</em> to the extent that it describes how much of something (correlation in this case) exists.</p>
</div>
<div class="paragraph">
<p>The code below allows our outcome variables and demographic characteristics to be examined using this quantity as well as visually through a scatterplot.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-R" data-lang="R"># Calculate correlation coefficient of net_trump by degree-educated.
trump  %&gt;%
  summarise(r=cor(net_trump, degree_educated)) %&gt;%
  pull(r)

# Generate scatterplot of net_trump by degree-educated. Draw OLS regression line.
trump %&gt;%
  ggplot(aes(x=net_trump, y=degree_educated))+
    geom_point(colour="#525252",pch=21, alpha=0.5)+
    geom_smooth(method = "lm", se = FALSE, colour="#525252")</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Instructions
</td>
<td class="hdlist2">
<p>Add the code block to your R script and Run. Do the same for <em>net_shift</em> and <em>net_leave</em>.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inspect_residuals_from_linear_model_for_quantifying_effect_of_em_degree_educated_em_on_the_outcome">Inspect residuals from linear model for quantifying effect of <em>degree-educated</em> on the outcome</h4>
<div class="paragraph">
<p>There appears to be a reasonably strong negative linear association between the Trump and Leave outcome variabls and the proportion of residents in counties and LADs educated to degree-level and above. This strength of association is greatest for the Brexit data (<em>r. -0.76</em>) and for the US, <em>degree-educated</em> is more heavily associated with <em>shift_trump</em> than <em>net_trump</em> (<em>r. -0.56</em> vs. <em>r. -0.46</em>). We can <em>model</em> for this relationship and talk about the effect of <em>degree-educated</em> on the our outcome variables using linear regression.</p>
</div>
<div class="paragraph">
<p>We have already generated a line representing this linear model with the command: <code>geom_smooth(method = "lm", se = FALSE)</code>. We can also generate an object storing model parameters and functions with the <code>lm()</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-R" data-lang="R"># Generate a univariate linear model object regressing net_trump on the
# degree-educated variable. Store object with name "lm_trumpshift_degrees".
lm_trumpshift_degrees &lt;- lm(shift_trump ~ degree_educated, data=trump)

summary(lm_trumpshift_degrees)
# Call:
#   lm(formula = shift_trump ~ degree_educated, data = trump)
#
# Residuals:
#   Min        1Q    Median        3Q       Max
# -0.200727 -0.031906 -0.002687  0.030099  0.145821
#
# Coefficients:
#   Estimate Std. Error t value Pr(&gt;|t|)
# (Intercept)      0.125315   0.001942   64.52   &lt;2e-16 ***
#   degree_educated -0.320837   0.008559  -37.48   &lt;2e-16 ***
#   ---
#   Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#
# Residual standard error: 0.04361 on 3106 degrees of freedom
# Multiple R-squared:  0.3115,	Adjusted R-squared:  0.3112
# F-statistic:  1405 on 1 and 3106 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Instructions
</td>
<td class="hdlist2">
<p>Run the code in the block above. You can generate a summary of the model output with the following call: <code>summary(&lt;model-object&gt;)</code>.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>The regression coefficients that appear after calls to <code>summary(&lt;model-object&gt;)</code> simply describe the regression line&#8201;&#8212;&#8201;and the regression line tells us, on average, what the <em>shift_trump</em> vote would be if it were entirely dependent on the proportion of the population educated to degree-level.  Since there is a negative association between <em>net_trump</em> and <em>degree-educated</em>, the <em>slope</em> of the regression line is negative. The coefficient for <em>degree-educated</em> (<code>Estimate Std. -0.32</code>) can be interpreted as: a one unit increase in the <em>degree-educated</em> population in a county has the effect of decreasing the <em>shift_trump</em> variable by c.0.32 units.</p>
</div>
<div class="paragraph">
<p>But how successful is this model? To what extent is variation in <em>shift_trump</em> entirely a function of variation in the proportion of people in counties educated to <em>degree-level</em>? It is possible to quantify how well the model fits the data, and importantly <em>where</em> it fits the data, by calculating <em>residuals</em>. Residuals are simply the difference between an observed value and the value expected by the model. The coefficient of determination (R-squared) is the sum of squared residuals divided by the squared sum of total residuals (or variance). It tells us how much of the variation in the outcome can be accounted for by the model. In this case 31% of variation in the observed <em>shift_trump</em> variable can be explained with variation in the <em>degree-educated</em> variable  (see output screen).</p>
</div>
<div class="paragraph">
<p>Ideally residuals should follow a <a href="https://en.wikipedia.org/wiki/Normal_distribution">normal distribution</a> and distribute randomly around the regression line, with no obvious systematic structure. One means of testing for normality is to generate a histogram on the residual variable, as in the block below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-R" data-lang="R"># Extract and store model residuals as a new variable.
trump &lt;- trump %&gt;%
  mutate(resids_shift_degrees=as_tibble(resid(lm_trumpshift_degrees))$value)

# Plot histogram of residuals.
trump %&gt;%
  ggplot(aes(resids_shift_degrees))+
  geom_histogram()

# Scatterplot of observed data coloured by residual.
trump %&gt;%
  ggplot(aes(x=degree_educated, y=shift_trump, fill=resids_shift_degrees))+
  geom_point(colour="#525252",pch=21, alpha=0.8)+
  geom_smooth(method = "lm", se = FALSE, colour="#525252")+
  scale_fill_distiller(palette="RdBu", direction=1, name="", limits=c(-0.21,0.21))


# Lineup test for spatial autocorrelation in residuals.

# Create the lineup data.
lineup_data &lt;- trump %&gt;%
  select(value=resids_shift_degrees)
lineup_data &lt;- do_lineup(lineup_data, 1)
lineup_data &lt;- lineup_data %&gt;%
  select(p1:p9) %&gt;%
  gather(key="perm", value="perm_values", -geometry)

# Plot the line-up.

# Using geom_sf and development version of ggplot2.
# Takes up plenty of graphics space so store as an object and write out to .png.
map_lineup &lt;- lineup_data %&gt;%
  ggplot()+
    geom_sf(aes(fill=perm_values), colour="#bdbdbd", size=0.05)+
    coord_sf(crs=st_crs(lineup_data), datum=NA)+
    facet_wrap(~perm)+
    scale_fill_distiller(palette="RdBu", direction=1, limits=c(-0.21,0.21), guide=FALSE, name="")+
    theme(axis.title=element_blank())
# Write out to .png.
ggsave("./map_lineup.png",plot=map_lineup, width=22, height=18, units="cm")

# Using the tmap package.
map_lineup &lt;- lineup_data %&gt;%
  tm_shape() +
    tm_fill(col="perm_values", style="cont", size=0.2, id="county_name", palette="-RdBu", title="")+
    tm_borders(col="#636363", lwd=0.2)+
    tm_facets("perm")+
    tm_layout(frame=FALSE, legend.show=FALSE)
ggsave("./map_lineup.png",plot=map_lineup, width=22, height=18, units="cm")</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Instructions
</td>
<td class="hdlist2">
<p>Run the code in the block above to generate a summary views on the residuals.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Individual coding task
</td>
<td class="hdlist2">
<p>Re-run the code block on the Brexit dataset. What do you notice about the distribution of residuals in the Brexit data and what does this imply for your data analysis?</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>As can be seen from the histogram, the distribution of residuals is reasonably normal though not entirely symmetrical&#8201;&#8212;&#8201;some counties contain large negative residuals where we overestimate the <em>shift_trump</em> variable given the levels of <em>degree_education</em> there. The choropleth map, however, suggests a very obvious spatial structuring to the residuals&#8201;&#8212;&#8201;the univariate model underestimates the extent of <em>trump shift</em> in Northern and Eastern states given those counties' (degree-level) demographics; the corollary is true for counties in Southern and Western states. The 'smoothness' of this spatial pattern is surprising (although there is a strong border around Utah and counties in neighbouring states).</p>
</div>
<div class="paragraph">
<p>Linear regression assumes <em>no</em> spatial autocorrelation in residuals. That it exists suggests that there is some systematic change or behaviour that we are not capturing adequately in our model. Exploring a richer set of explanatory variables may help address some of the spatial dependency in residuals. However, it is also possible that the explanatory variables organise differently over space, that different processes operate in different locations and that there are geographically-varying interactions between variables.</p>
</div>
<div class="openblock">
<div class="title">Figure 2: Map lineup of residuals from model assuming <em>shift_trump</em>  is a linear function of <em>degree_educated</em>.</div>
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="images/map_lineup.png" alt="map_lineup" width="1000"></span></p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Geographers typically test for <em>spatial autocorrelation</em> using spatial statistics&#8201;&#8212;&#8201;<a href="https://en.wikipedia.org/wiki/Moran%27s_I">Moran&#8217;s I</a> is a measure of effect size for spatial autocorrelation. They do so by comparing an observed value of Moran&#8217;s I against a theoretical distribution that would result under <em>complete spatial randomness</em> (CSR)&#8201;&#8212;&#8201;in this case, this is the assumption that residuals distribute around counties entirely independent of location.</p>
</div>
<div class="paragraph">
<p>Of course in Figure 2 we perform such a test visually&#8201;&#8212;&#8201;comparing the observed choropleth against a set of choropleths that one might expect to see under CSR.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_task_2_association_between_trump_and_brexit_and_other_candidate_variables">Task 2. Association between Trump and Brexit and other candidate variables</h3>
<div class="openblock">
<div class="title">Figure 3: Small multiple plots displaying associations between <em>net_leave</em> and area-level demographics.</div>
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="images/scatter.png" alt="scatters" width="1000"></span></p>
</div>
</div>
</div>
<div class="paragraph">
<p>You will by now have noticed that there are several area-level explanatory variables in the <em>Brexit</em> and <em>Trump</em> data frames. These have been carefully selected based on existing literature around the rise of populist voting behaviour. We will make comparisons in associations between our outcome variables and these area-level variables visually, using <a href="https://en.wikipedia.org/wiki/Small_multiple">small multiples</a>&#8201;&#8212;&#8201;a set of graphics juxtaposed next to one another, ideally in a meaningful order, such that graphics can be compared.</p>
</div>
<div class="paragraph">
<p><em>ggplot2</em> usefully supports small multiples with functions such as <code>facet_wrap()</code> and <code>facet_grid()</code>. A requirement of calls to <em>ggplot2</em>'s <code>facet</code> functions is <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">Tidy</a> data&#8201;&#8212;&#8201;where just one observation appears per row. Rows in the the data frame are then split and a separate chart is created for each tranche of data.</p>
</div>
<div class="paragraph">
<p>To generate small multiples of the scatterplots in the previous section, we have to collapse our data frame such that a single row is given to each county or LAD <em>and</em> explanatory variable&#8201;&#8212;&#8201;basically we need to make our data frame taller and thinner. The <em>tidyr</em> package provides methods that allow these types of operations. In the code block below the <code>gather()</code> method is used to collapse multiple columns into rows. Remember you can check the documentation for this function by typing into the R Console <code>?gather</code>.</p>
</div>
<div class="paragraph">
<p>Rather than clutter the small multiples with individual points, only the regression lines are shown. This is achieved with a slight hack&#8201;&#8212;&#8201;we set <code>geom_point()</code> with total transparency (<code>alpha=0</code>). The bold lines in Figure 3 represent the overall regression line and in grey are separate lines for each GB region. The addition of the regional lines allows us to investigate whether the scale and interaction between variables is regionally specific. General heuristics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Parallel slopes with little variation in vertical position (e.g. <em>degree-educated</em> with the obvious exception of Scotland)&#8201;&#8212;&#8201;variation is not regionally structured and that interactions between variables are generally consistent.</p>
</li>
<li>
<p>Parallel slopes with large variation in vertical position (<em>household_income</em>)&#8201;&#8212;&#8201;variable&#8217;s scale is regionally structured but a consistent association exists.</p>
</li>
<li>
<p>Substantial changes in slope (<em>older_adults</em>?)&#8201;&#8212;&#8201;regional specificity in the scale of those variables and perhaps the nature of association with the outcome.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-R" data-lang="R"># Small multiple plot of associations with _net_leave_ and area-level demographics.
# First gather() variables to include in the  plot, so that we can supply variable name to facet_wrap().
# Create a global regression line based on all points (stat_smooth).
# And one contingent on region (group=region_abbr).
brexit %&gt;%
  gather(c(degree_educated:pop_density), key = "var", value="value") %&gt;%
  ggplot(aes(x=value, y=net_leave))+
  geom_point(colour="#525252",pch=21, alpha=0) +
  stat_smooth(method=lm, se=FALSE, size=0.5, colour="#525252")+
  stat_smooth(aes(group=region_abbr), method=lm, se=FALSE, size=0.2, colour="#969696")+
  facet_wrap(~var, scales="free", nrow=3)+
  theme(axis.text=element_blank(),
        axis.title=element_blank())</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Instructions
</td>
<td class="hdlist2">
<p>Run the code in the block above to generate small multiple summaries of associations.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Individual coding task
</td>
<td class="hdlist2">
<p>Re-run the code block on the Trump and Brexit dataset to make comparisons across our three outcome variables. Remember, we assume that US counties and states and regions and LADs are roughly equivalent geographies. What do you notice about these associations?</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whilst one form of <em>untidy</em> data is observations distributed amongst columns, the reverse is also common&#8201;&#8212;&#8201;where observations are duplicated amongst rows. <em>tidyr</em> provides a helper function (<code>spread()</code>) that has the opposite effect to <code>gather()</code>&#8201;&#8212;&#8201;unsurprisingly, this spreads duplicated observations amongst columns, creating new variables.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_task_3_interrogate_into_regionally_varying_association">Task 3. Interrogate into regionally-varying association</h3>
<div class="openblock">
<div class="title">Figure 4: Spatially ordered map of associations between <em>degree-educated</em> and <em>net_trump</em>.</div>
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="images/spatial_associations.png" alt="spatial associations"></span></p>
</div>
</div>
</div>
<div class="paragraph">
<p>Hopefully from the analysis above you have developed some insight into associations between the Trump and Brexit outcome variables and area-level demographics. Augmenting our plots with <em>local</em> regression lines provides useful additional information. Firstly, it is very likely that the <em>scale</em> of variables might be different in different parts of the country&#8201;&#8212;&#8201;a density plot of small multiples (faceted on state) shows that income distributions tend to be higher and wider in the counties of New England than those in Southern Central US. Such distinctions are important: a consistent pattern of interactions between demographics and voting behaviour might exist, but these interactions can be hidden in global models that do not allow for local context – that assume each each US county and GB LAD results from the same population and process. Secondly, it is also possible that very different processes are operating between these two regions – that the extent and even direction of association between income and voting preference may vary for these different parts of the US.</p>
</div>
<div class="paragraph">
<p>There are techniques that can be used to account for this&#8201;&#8212;&#8201;for examlpe, I&#8217;ve recently published a paper (<a href="http://openaccess.city.ac.uk/19048/">Beecham et al., in press</a>) applying <a href="https://en.wikipedia.org/wiki/Multilevel_model">multi-level</a> modelling and <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/j.1538-4632.1996.tb00936.x">geographically-weighted statistics</a> on the Brexit dataset. Both of these approaches (multi-level modelling and geographical weighted statistics) result in some form of <em>local</em> parameter estimates&#8201;&#8212;&#8201;and we&#8217;ve already generated local estimates in Figure 3 with the addition of regionally-varying regression lines above. An important analytic task remains: to characterise spatial patterns in these locally-varying estimates. I&#8217;d argue that this is a task that visualization uniquely supports.</p>
</div>
<div class="paragraph">
<p>So our final activity is to explore how the differing associations between the outcome variables and area-level demographics implied by the plots above vary over space. We will do so by generating <em>spatially arranged</em> small multiples: separate plots describing associations in each US state and GB region, but with plots arranged according to their approximate spatial position. You will notice in the code block below that to affect such an arrangement requires only a minimal modification to the ggplot2 specification: <code>facet_grid(x~y)</code>&#8201;&#8212;&#8201;where <code>x,y</code> describes the approximate position of each state/region.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-R" data-lang="R"># Faceted scatterplot of degree_educated on net_trump arranged according to approximate spatial position.
trump %&gt;%
ggplot()+
  geom_point(aes(x=degree_educated, y=net_trump), colour="#525252",pch=21, alpha=0.2)+
  stat_smooth(aes(x=degree_educated, y=net_trump), method=lm, se=FALSE, size=0.6, colour="#525252")+
  facet_grid(gridY~gridX, shrink=FALSE, scales = "free_x")

# I have encapsulated a more detailed specification into a function in a separate R script.
# Load into R session.
source(paste0(session_url, "./src/build_scatter_region.R"))

# Generate a tibble without geometry list-col (there's a boring reason for this).
trump_ungeom &lt;- trump
st_geometry(trump_ungeom) &lt;- NULL

# Call build_scatter_region() function to  ggplot2 object.
build_region_scatter(trump_ungeom, quo(degree_educated), quo(net_trump), quo(state_abbr))</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Instructions
</td>
<td class="hdlist2">
<p>Run the code in the block above to generate small multiple summaries of associations.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Individual coding task
</td>
<td class="hdlist2">
<p>I have encapsulated a more detailed specification as a function. In addition to plotting individual data points and a regression line, plot background is varied according to size of association (<em>r.</em>) with the outcome. Once loaded, you can use this function to generate spatially ordered plots of other explanatory variables.</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There is an established literature in information visualization on how to effect semi-spatial arrangements. For an overview and  interesting and elegant approach, see <a href="https://www.gicentre.net/small-multiples-with-gaps/">Meulemans <em>et al.</em> (2017)</a>.</p>
</div>
<div class="paragraph">
<p>You might have noticed a strange function (<code>quo</code>) used when we pass variable names as parameters into  <code>build_region_scatter()</code>. The reason for this is that the <em>dplyr</em> functions we use throughout (and also in <code>build_refion_scatter()</code>) use non-standard evaluation&#8201;&#8212;&#8201;they are not referentially transparent&#8201;&#8212;&#8201;and this creates problems when we wish to make use of <em>dplyr</em> programmatically. For a coherent, efficient and accessible discussion, see this post on <a href="https://dplyr.tidyverse.org/articles/programming.html">programming with dplyr</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Beecham, R. et al. (in press) <a href="http://openaccess.city.ac.uk/19048/">Locally-varying explanations behind the United Kingdom&#8217;s vote to leave the United Kingdom</a>. <em>Journal of Spatial Information Science</em>.</p>
</li>
<li>
<p>Meulemans, W. et al. (2017) <a href="http://openaccess.city.ac.uk/15167/">Small multiples with gaps</a>. <em>IEEE Transactions on Visualization &amp; Computer Graphics</em>, 23(1):381–390. Code and web-interface is available at the <a href="https://www.gicentre.net/featuredpapers/#/meulemanssmall2016/">paper website</a>.</p>
</li>
</ul>
</div>
<hr>
<div class="paragraph">
<p><span class="small">Content by <a href="http://www.roger-beecham.com">Roger Beecham</a> | 2018 | Licensed under <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons BY 4.0</a>.</span></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-05-01 20:30:57 BST
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>